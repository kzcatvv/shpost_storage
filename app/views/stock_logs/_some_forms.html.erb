<%- model_class = StockLog -%>
<!-- <%= form_tag('/stock_logs/updateall', method: :post) do -%> -->

<%= grid(@stock_logs_grid, show_filters: :no) do |g|

    g.column do |stock_log|
      hidden_field_tag("stock_logs[][id]", stock_log.id, id: "stock_logs_id_#{stock_log.id}")
      # if @purchase
      #   [@purchase.id, {id: "stock_logs_id_#{stock_log.id}"}]
      # else
      #   [stock_log.id, {id: "stock_logs_id_#{stock_log.id}"}]
      # end
    end

    if @purchase
      g.column name: model_class.human_attribute_name(:pd_name), attribute: 'name', ordering: false, model: 'PurchaseDetail' do |stock_log|
        # if stock_log.status == 'waiting'
          select_tag("stock_logs[][pdid]", options_for_select(PurchaseDetail.accessible_by(current_ability).map{|u| [u.batch_no+"_"+u.name,u.id]}, stock_log.purchase_detail_id), id: "stock_logs_pdid_#{stock_log.id}", style: "display: none;", onblur: 'clickout(this)') <<
          content_tag(:p, stock_log.purchase_detail.batch_no+"_"+stock_log.purchase_detail.name, {id: "stock_logs_pdid_#{stock_log.id}", onclick: 'clickin(this);'})
        # else
        #   stock_log.purchase_detail.batch_no+"_"+stock_log.purchase_detail.name
        # end
      end
    end

    if @orders
      g.column name: model_class.human_attribute_name(:kcorder_name), attribute: 'keyclient_name', ordering: false, model: 'Keyclientorder' do |stock_log|
        # if stock_log.status == 'waiting'
          select_tag("stock_logs[][pdid]", options_for_select(Keyclientorder.accessible_by(current_ability).map{|u| [u.id+"_"+u.keyclient_name,u.id]}, stock_log.order_detail_id), id: "stock_logs_odid_#{stock_log.id}", style: "display: none;", onblur: 'clickout(this)') <<
          content_tag(:p, stock_log.order_detail.keyclientorder.id+"_"+stock_log.order_detail.keyclientorder.keyclient_name, {id: "stock_logs_odid_#{stock_log.id}", onclick: 'clickin(this);'})
        # else
        #   stock_log.purchase_detail.batch_no+"_"+stock_log.purchase_detail.name
        # end
      end
    end

    g.column name: model_class.human_attribute_name(:shelf_code), attribute: 'shelf_code', ordering: false, model: 'Shelf' do |stock_log|
      # if stock_log.status == 'waiting'
        select_tag("stock_logs[][shelfid]", options_for_select(Shelf.accessible_by(current_ability).map{|u| [u.shelf_code,u.id]}, stock_log.stock.shelf.id), id: "stock_logs_shelfid_#{stock_log.id}", style: "display: none;", onblur: 'clickout(this)') <<
        content_tag(:p, stock_log.stock.shelf.shelf_code, {id: "stock_logs_shelfid_#{stock_log.id}", onclick: 'clickin(this);'})
      # else
      #   stock_log.stock.shelf.shelf_code
      # end
    end

    g.column name: model_class.human_attribute_name(:stock_amount), attribute: 'actual_amount',  ordering: false, model: 'Stock' do |stock_log|
      [stock_log.stock.actual_amount,{id: "stock_logs_actamount_#{stock_log.id}"}]
    end

    g.column name: model_class.human_attribute_name(:amount), attribute: 'amount',  ordering: false do |stock_log|
      # if stock_log.status == 'waiting'
        text_field_tag("stock_logs[][amount]", stock_log.amount, id: "stock_logs_amount_#{stock_log.id}", style: "display: none; width: 40px;", onblur: 'clickout(this)') <<
        if stock_log.amount == 0
          content_tag(:p, stock_log.amount, {id: "stock_logs_amount_#{stock_log.id}", onclick: 'clickin(this);', style: 'background-color: red;'})
        else
          content_tag(:p, stock_log.amount, {id: "stock_logs_amount_#{stock_log.id}", onclick: 'clickin(this);'})
        end
      # else
      #   [stock_log.amount, {id: "stock_logs_amount_#{stock_log.id}"}]
      # end
    end

    g.column name: model_class.human_attribute_name(:status), attribute: 'status', ordering: true, custom_filter: StockLog::STATUS.invert do |stock_log|
        [StockLog::STATUS[stock_log.status.to_sym],{id: "stock_logs_status_#{stock_log.id}"}]
    end

    g.column name: model_class.human_attribute_name(:created_at), attribute: 'created_at', ordering: false do |stock_log|
        stock_log.created_at.to_s(:db)
      end

    g.column name: model_class.human_attribute_name(:checked_at), attribute: 'checked_at', ordering: false do |stock_log|
        stock_log.checked_at.try :to_s, :db
    end

    g.column do |stock_log|
      # if stock_log.status == 'waiting'
        ActiveSupport::SafeBuffer.new <<
          # (hidden_field_tag "stock_logs[][id]", stock_log.id) << ' ' <<
          # (submit_tag('check!!'))  #<< ' ' <<
          # (button_tag() do
          #   content_tag(:strong, 'check')
          # end)  << ' ' <<
          # (link_to t('.delete', :default => t("helpers.links.delete")), split_stock_log_path(stock_log.id), :class => 'btn btn-xs btn-primary', id: "test_#{stock_log.id}")
          (link_to t('.destroy', :default => t("helpers.links.destroy")), "javascript:void(0);", onclick: 'destroy(this)', id: "stock_logs_link_#{stock_log.id}", :class => 'btn btn-xs btn-danger' if can? :destroy, stock_log)
      end
    # end
  end
%>

<!-- <%= submit_tag('check!!') %> -->

<!-- <% end -%> -->

  <div style="float:right">
    <% if can? :new, Stock %>
      <% if @purchase %>
        <%= link_to t('.new', :default => t("helpers.links.new")),
                   "javascript:void(0)", onclick: "add()",
                    :class => 'btn btn-primary' %>
      <% end %>
    <% end %>
  </div>
